
## ğŸ“ é¡¹ç›®ç»“æ„

```
app/
â”‚
â”œâ”€â”€ __main__.py                   # åº”ç”¨å¯åŠ¨å…¥å£
â”œâ”€â”€ config.py                     # é…ç½®é¡¹ä¸ OpenAI/DeepSeek API å®¢æˆ·ç«¯åˆå§‹åŒ–
â”œâ”€â”€ logger.py                     # æ—¥å¿—ç³»ç»Ÿé…ç½®
â”œâ”€â”€ llm.py                        # æ ¸å¿ƒ LLM å¯¹è¯é€»è¾‘åŠ TOOLS è§¦å‘åˆ†æ
â”œâ”€â”€ file_manager.py               # æ–‡ä»¶ç®¡ç†ï¼šä¸Šä¼ ã€ä¼šè¯éš”ç¦»ã€æ–‡ä»¶å±•ç¤ºç­‰
â”‚
â”œâ”€â”€ interface/
â”‚   â”œâ”€â”€ interface.py              # Gradio å‰ç«¯æ„å»ºä¸äº‹ä»¶äº¤äº’
â”‚   â”œâ”€â”€ ui_assets.py              # é™æ€èµ„æºç®¡ç†
â”‚   â””â”€â”€ static/
â”‚       â”œâ”€â”€ styles.css            # å…¨å±€ UI æ ·å¼è¡¨
â”‚       â”œâ”€â”€ ui_utils.js           # é€šç”¨ UI å¢å¼ºè„šæœ¬
â”‚       â””â”€â”€ sidebar_handlers.js   # å·¦å³ä¾§è¾¹æ çš„è¡Œä¸ºæ§åˆ¶è„šæœ¬
â”‚
â””â”€â”€ tools/
    â””â”€â”€ ToolsProcessor.py         # TOOLS æŒ‡ä»¤æå–ä¸å·¥å…·é“¾ä»»åŠ¡è°ƒåº¦å¤„ç†
```

---

## ğŸ”§ åç«¯æ¨¡å—è¯´æ˜ï¼ˆBackendï¼‰

### `llm.py`
- **chat_with_cfo(conversation, user_message)**
  - å…³é”®å¯¹è¯æµç¨‹å‡½æ•°ï¼ˆå¼‚æ­¥ç”Ÿæˆå™¨ï¼‰ã€‚
  - å®ç°ï¼šç”¨æˆ·è¾“å…¥ â†’ ç³»ç»Ÿæç¤ºæ³¨å…¥ â†’ DeepSeek æ¥å£ â†’ è¯†åˆ« TOOLS â†’ è‡ªåŠ¨å¤„ç†å¹¶è¿”å›ã€‚
  - å†…ç½®çŠ¶æ€ï¼šå¤„ç†ä¸­æ ‡è®°ã€å·¥å…·è¿›åº¦æ˜¾ç¤ºã€æ‰§è¡Œæ‘˜è¦ç”Ÿæˆã€‚

---

### `ToolsProcessor.py`
- **extract_tools_content(msg)**ï¼šè§£æ `[[TOOLS:TRUE][å†…å®¹]]` æ ¼å¼ï¼Œè¿”å›çŠ¶æ€ä¸å†…å®¹ã€‚
- **process_tools_request_async_with_progress(content, callback)**ï¼šå¼‚æ­¥æ‰§è¡Œå·¥å…·è¯·æ±‚ï¼Œå›ä¼ æ‰§è¡Œè¿›åº¦ã€‚
- **process_tools_request(content)**ï¼šåŒæ­¥å°è£…ç‰ˆï¼ˆä¾›éå¼‚æ­¥ä¸Šä¸‹æ–‡ä½¿ç”¨ï¼‰ã€‚
- **process_message(msg)**ï¼šç»¼åˆå¤„ç†å«å·¥å…·æ ‡ç­¾çš„å›å¤å†…å®¹ã€‚

---

### `file_manager.py`
- **create_file_directories() / create_session_directory()**ï¼šè‡ªåŠ¨åˆ›å»ºéš”ç¦»æ–‡ä»¶ç›®å½•ã€‚
- **handle_file_upload(files, session_dir)**ï¼šå°†ä¸Šä¼ æ–‡ä»¶å¤åˆ¶å…¥å½“å‰ä¼šè¯ç›®å½•ã€‚
- **get_directory_files(directory)**ï¼šè·å–æ–‡ä»¶æ¸…å•ã€‚
- **generate_file_list_html(files)**ï¼šæ¸²æŸ“ UI æ–‡ä»¶æµè§ˆå™¨ HTMLã€‚

---

## ğŸ–¥ï¸ å‰ç«¯ç»„ä»¶è¯´æ˜ï¼ˆFrontendï¼‰

### ğŸ“ Gradio UI æ„æˆï¼ˆ`interface.py`ï¼‰
- `create_interface()`ï¼šæ•´ä½“å¸ƒå±€æ„é€ å‡½æ•°ï¼Œè°ƒç”¨ UI æ„ä»¶ã€å®šä¹‰äº‹ä»¶ç»‘å®šã€‚

#### UI æ„æˆåŒºå—ï¼š
- `å·¦ä¾§è¾¹æ `ï¼šåŠŸèƒ½åŒºé¢„ç•™
- `ä¸­å¤®èŠå¤©`ï¼š
  - `chatbot`ï¼šå¯¹è¯ä¸»åŒºåŸŸï¼Œæ”¯æŒ markdown æ¸²æŸ“ + å·¥å…·è¿›åº¦æ’å…¥ã€‚
  - `user_input` / `send_btn` / `stop_btn`ï¼šäº¤äº’è¾“å…¥ç»„ä»¶ã€‚
- `å³ä¾§è¾¹æ `ï¼š
  - æ–‡ä»¶ä¸Šä¼ åŒºï¼ˆæ‹–æ‹½/æµè§ˆï¼‰
  - æ–‡ä»¶å±•ç¤ºåŒºï¼ˆè°ƒç”¨ HTML æ¸²æŸ“ï¼‰

#### å“åº”äº‹ä»¶ç»‘å®šï¼š
- ä¸Šä¼ æŒ‰é’® â†’ `upload_and_update()`ï¼šå¤„ç†æ–‡ä»¶ä¿å­˜ + åˆ·æ–°åˆ—è¡¨ã€‚
- è¾“å…¥æ¡†æˆ–å‘é€æŒ‰é’® â†’ `respond()`ï¼šè§¦å‘ LLM å›å¤ç”Ÿæˆã€‚
- å·¥å…·å¤„ç†è¿›åº¦ä¸æ‘˜è¦ â†’ è‡ªåŠ¨æ’å…¥ UIã€‚
- çŠ¶æ€å˜é‡ï¼š`session_dir_state`, `conv_state`, `generating_state`ã€‚

---

## ğŸ¨ é™æ€èµ„æºè¯´æ˜ï¼ˆ`static/`ï¼‰

| æ–‡ä»¶å | åŠŸèƒ½è¯´æ˜ |
|--------|----------|
| `styles.css` | å…¨å±€æ·±è‰²ä¸»é¢˜æ ·å¼ï¼Œå“åº”å¼æ”¯æŒï¼Œæ§ä»¶å¸ƒå±€ç»†åŒ– |
| `ui_utils.js` | åˆå§‹åŒ–å¸ƒå±€æ£€æµ‹ã€å¤åˆ¶æŒ‰é’®æ”¯æŒã€æ–‡ä»¶åˆ·æ–°ã€å…¨å±€å¿«æ·é”® |
| `sidebar_handlers.js` | å·¦å³ä¾§è¾¹æ æ§åˆ¶é€»è¾‘ï¼Œå…¨å±ä¸‹è¿”å›æŒ‰é’®æ§åˆ¶ |

---

## ğŸ§ª å‡½æ•°ä¸€è§ˆè¡¨ï¼ˆæ ¸å¿ƒå‡½æ•°ï¼‰

| æ¨¡å— | å‡½æ•°å | åŠŸèƒ½ç®€è¿° |
|------|--------|----------|
| llm.py | chat_with_cfo | å¼‚æ­¥å¤„ç†ç”¨æˆ·å¯¹è¯ä¸å·¥å…·è‡ªåŠ¨è°ƒç”¨ |
| ToolsProcessor.py | extract_tools_content | æå– TOOLS æ ‡ç­¾å†…å®¹ |
| ToolsProcessor.py | process_tools_request_async_with_progress | å¼‚æ­¥æ‰§è¡Œå·¥å…·å¹¶å®æ—¶å›è°ƒè¿›åº¦ |
| ToolsProcessor.py | process_message | æ•´ç†ä¸æ ¼å¼åŒ–æœ€ç»ˆ LLM å›å¤å†…å®¹ |
| file_manager.py | handle_file_upload | å¤„ç†ç”¨æˆ·ä¸Šä¼ å¹¶å½’æ¡£æ–‡ä»¶ |
| interface.py | respond | ä¸»å‰ç«¯å“åº”å‡½æ•° |
| interface.py | format_message | æ ¼å¼åŒ–æ¶ˆæ¯å±•ç¤ºå·¥å…·çŠ¶æ€ä¸æ‘˜è¦ |

---